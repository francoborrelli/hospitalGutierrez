{% extends 'utils/base.html.twig' %} 

{% block stylesheets %}
    <link rel="stylesheet" href="/web/assets/dataTables/css/dataTables.bootstrap4.min.css"> 
    <link rel="stylesheet" href="/web/assets/dataTables/css/responsive.bootstrap4.min.css"> 
{% endblock %} 

{% block body %}

    {% if currentUser.hasPermission('usuario_new') %}
        {% include 'Users/addUser.html.twig' %}
    {% endif %}    

    {% if currentUser.hasPermission('usuario_destroy') %}
        {% include 'Users/deleteUser.html.twig' %}
    {% endif %} 

    {% if currentUser.hasPermission('usuario_update') %}
        {% include 'Users/editUser.html.twig' %}
    {% endif %} 


    <div class="container userReport tableScreen">
        <div class="row">
            {% include 'Users/userSearch.html.twig' %}
            <div class ="col-md-9">
                <div class="card">
                    <div class="card-header text-left">
                        <a class="btn detalle" id="goBack" title="Volver al inicio" href="/"><i class="fa fa-reply" aria-hidden="true"></i></a>
                        <h3>Usuarios</h3>
                    </div>
                    <div class="card-block">
                        <div class="tablePage">
                            {% if currentUser.hasPermission('usuario_new') %}
                                <button type="button" id="agregar-btn" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#addUser">Agregar</button>
                            {% endif %} 
                            <table class="table table-striped" id="usuarios">
                            <thead>
                                <tr>
                                    <th>Nombre de Usuario</th>
                                    <th>Nombre</th>
                                    <th>Apellido</th>
                                    <th>Email</th>
                                    <th>Roles</th>
                                    <th>Estado</th>
                                    <th>Opciones</th>
                                </tr>
                            </thead>
                            </tbody>
                                {% include 'Users/users.html.twig' %}
                            </tbody>
                            </table>

                            <!-- paginacion -->
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <li class="page-item {% if data.page == 1 %} disabled {% endif %}">
                                        <a class="page-link"
                                            href="/admin/users/{{ data.page - 1 }}?username={{ data.username }}&state={{ data.state }}"
                                            tabindex="-1">Ant
                                        </a>
                                    </li>
                                    {% for i in 1..data.pages %}
                                        <li class="page-item {% if i == data.page %} active {% endif %}">
                                            <a class="page-link"
                                                href="/admin/users/{{ i }}?username={{ data.username }}&state={{ data.state  }}">{{ i }}
                                            </a>
                                        </li>
                                    {% endfor %}
                                    <li class="page-item {% if data.page == data.pages %} disabled {% endif %}">
                                        <a class="page-link" href="/admin/users/{{ data.page + 1 }}?username={{ data.username }}&state={{ data.state  }}">Sig</a>
                                    </li>
                                </ul>
                            </nav>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %} 


{% block javascripts %}

    <script src="/web/assets/jquery-validate/jquery.validate.min.js"></script>
    <script src="/web/assets/dataTables/js/datatables.min.js"></script>
    <script src="/web/assets/dataTables/js/responsive.bootstrap4.min.js"></script>
    <script src="/web/dist/js/users.js"></script>
    <script src="/web/dist/js/multi-step-modal.js"></script>

    <!-- scripts requeridos de acuerdo a permisos -->
    {% if currentUser.hasPermission('usuario_new') %}
        <script src="/web/dist/js/addUserValidation.js"></script>
    {% endif %}

    {% if currentUser.hasPermission('usuario_update') %}  
        <script src="/web/dist/js/editUserValidation.js"></script>
    {% endif %}

   {% if (not currentUser.hasPermission('usuario_update')) and (not currentUser.hasPermission('usuario_destroy')) %}  
        <script>
        $(document).ready(function() {
                oTable.column(6).visible(false)
        } );
        </script>
    {% endif %}

    <!-- scripts requeridos de acuerdo a errores de validaciÃ³n -->
    {% if newErrors is defined %}
        <script>
            $('#addUser').modal('show')
        </script>
    {% elseif editErrors is defined %}
        <script>
            $('#editUser').modal('show')
        </script>
    {% endif %}

{% endblock %}
